{"version":3,"file":"component---src-pages-lobby-js-cb20091eae03c624672d.js","mappings":"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","sources":["webpack://gatsby-apollo-starter/./src/components/Lobby.js","webpack://gatsby-apollo-starter/./src/pages/lobby.js"],"sourcesContent":["import React, { useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport  Link from 'gatsby-link'\nimport { useMutation } from '@apollo/react-hooks'\nimport { navigate } from 'gatsby'\nimport { toaster } from 'evergreen-ui'\n\nimport { FullPageDiv } from '../components/styled-components/FullPageDiv'\nimport { Typography, Button, PlayerList } from './primitives'\nimport { formatters } from '../../utils/functions'\nimport { withFirebaseAuthentication } from './hocs/withFirebaseAuthentication'\nimport { DELETE_ROOM, UPDATE_ROOM } from '../../utils/graphql/mutations'\n\nconst RoomSettings = ({room}) => {\n\n\treturn (\n\t\t<div className=\"my-4 text-center\">\n\t\t\t{\n\t\t\t\troom?.settings && Object.keys(room?.settings).map(settingKey => {\n\t\t\t\t\treturn <Typography key={settingKey} variant=\"p\">{settingKey}: {room?.settings[settingKey]}</Typography>\n\t\t\t\t})\n\t\t\t}\n\t\t</div>\n\t)\n}\n\nRoomSettings.propTypes = {\n\troom: PropTypes.object\n}\n\nconst Lobby = ({ user, room, subscribeToRoomUpdates, subscribeToDeletion }) => {\n\n\tuseEffect(() => {\n\t\tif (user?.uid && !room?.players.map(p => p.uid).includes(user.uid)) {\n\t\t\tif(room?.players.length < room?.settings.maxPlayers)\n\t\t\t\taddPlayer({\n\t\t\t\t\tdisplayName: user.displayName,\n\t\t\t\t\temail: user.email,\n\t\t\t\t\tphotoURL: user.photoURL,\n\t\t\t\t\tphoneNumber: user.phoneNumber,\n\t\t\t\t\tuid: user.uid\n\t\t\t\t})\n\t\t}\n\t\t\n\t\tif (user === null || !Object.keys(user).length) {\n\t\t\tconsole.log('allow play as guest')\n\t\t}\n\t}, [user])\n\n\tuseEffect(() => {\n\t\tconsole.log('lobby subscribing to room updates')\n\t\tsubscribeToRoomUpdates()\n\t\tsubscribeToDeletion()\n\t}, [])\n\n\tconst [updateRoomMutation] = useMutation(\n\t\tUPDATE_ROOM, {\n\t\t\tonError: (err) => {\n\t\t\t\ttoaster.danger(formatters.extractGQLErrorMessage(err))\n\t\t\t}\n\t\t}\n\t)\n\n\tconst addPlayer = (player) => {\n\t\tconsole.log('mutating room from lobby')\n\n\t\tupdateRoomMutation(\n\t\t\t{\n\t\t\t\tvariables: {\n\t\t\t\t\troom: {\n\t\t\t\t\t\t...room,\n\t\t\t\t\t\tplayers: [\n\t\t\t\t\t\t\t...room?.players,\n\t\t\t\t\t\t\tplayer\n\t\t\t\t\t\t]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t}\n\n\tconst removePlayer = (player) => {\n\t\tconsole.log('mutating room from lobby')\n\n\t\tupdateRoomMutation(\n\t\t\t{\n\t\t\t\tvariables: {\n\t\t\t\t\troom: {\n\t\t\t\t\t\t...room,\n\t\t\t\t\t\tplayers: [\n\t\t\t\t\t\t\t...room?.players.filter(p=>p.uid !== player.uid)\n\t\t\t\t\t\t]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t}\n\n\tconst startGame = () => {\n\t\tconsole.log('mutating room from lobby')\n\n\t\tupdateRoomMutation(\n\t\t\t{\n\t\t\t\tvariables: {\n\t\t\t\t\troom: {\n\t\t\t\t\t\t...room,\n\t\t\t\t\t\tstarted: true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t}\n\n\n\tconst [deleteRoomMutation, {loading: loadingRoomDeletion}] = useMutation(\n\t\tDELETE_ROOM, {\n\t\t\tonCompleted: (data) => {\n\t\t\t\t//navigate to home\n\t\t\t\tnavigate('/') \n\t\t\t},\n\t\t\tonError: (err) => {\n\t\t\t\ttoaster.danger(formatters.extractGQLErrorMessage(err))\n\t\t\t}\n\t\t}\n\t)\n\n\tconst deleteRoom = () => {\n\t\tdeleteRoomMutation(\n\t\t\t{\n\t\t\t\tvariables: {\n\t\t\t\t\thost:  user.uid\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t}\n\n\treturn (\n\t\t<FullPageDiv>\n\t\t\t<Typography variant=\"h3\" weight=\"bold\" className=\"m-0\">Wait here for others to join...</Typography>\n\t\t\t<Typography variant=\"h5\">The host will start the game soon.</Typography>\n\t\t\t<PlayerList players={room?.players} />\n\t\t\t<RoomSettings room={room} />\n\t\t\t<Link to=\"/\">\n\t\t\t\t<Button className=\"mb-4\" outline>Back to home</Button>\n\t\t\t</Link>\n\t\t\t{\n\t\t\t\tuser?.uid === room?.host\n\t\t\t\t\t? <Button className=\"mb-4\" color=\"MediumSeaGreen\" outline onClick={()=>startGame()}>Start Game</Button>\n\t\t\t\t\t: null\n\t\t\t}\n\t\t\t{\n\t\t\t\tuser?.uid === room?.host\n\t\t\t\t\t? <Button className=\"mb-4\" color='Crimson' outline onClick={deleteRoom} loading={loadingRoomDeletion}>End game</Button>\n\t\t\t\t\t: <Button className=\"mb-4\" color='Crimson' outline onClick={()=>removePlayer({uid:user?.uid})} loading={loadingRoomDeletion}>Leave game</Button>\n\t\t\t}\n\t\t</FullPageDiv>\n\t)\n}\n\nLobby.propTypes = {\n\troom: PropTypes.object,\n\tuser: PropTypes.object,\n\tsubscribeToRoomUpdates: PropTypes.func,\n\tsubscribeToDeletion: PropTypes.func\n}\n\nexport default withFirebaseAuthentication(Lobby)\n","import React from 'react'\nimport SEO from '../components/seo'\n\nimport Lobby from '../components/Lobby'\nimport { Layout } from '../Layout'\n\nconst Content = () => (\n\t<>\n\t\t<SEO title=\"Join Game\" />\n\t\t<Lobby/>\n\t</>\n)\n\n\nconst LobbyPage = () => ( \n\t<Layout\n\t\ttitle=\"Join Game\"\n\t\tcontent={<Content/>}\n\t/>\n)\n\nexport default LobbyPage\n"],"names":["RoomSettings","room","className","settings","Object","keys","map","settingKey","key","variant","withFirebaseAuthentication","user","subscribeToRoomUpdates","subscribeToDeletion","useEffect","uid","players","p","includes","length","maxPlayers","addPlayer","displayName","email","photoURL","phoneNumber","console","log","updateRoomMutation","useMutation","UPDATE_ROOM","onError","err","toaster","formatters","player","variables","DELETE_ROOM","onCompleted","data","navigate","deleteRoomMutation","loadingRoomDeletion","loading","weight","to","outline","host","color","onClick","started","filter","Content","title","content"],"sourceRoot":""}