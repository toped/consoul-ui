"use strict";(self.webpackChunkgatsby_apollo_starter=self.webpackChunkgatsby_apollo_starter||[]).push([[885],{7674:function(e,n,t){var r=t(2982),o=t(7294),a=t(8037),l=t(3919),i=t(5444),s=t(4767),u=t(8937),c=t(259),m=t(9335),d=t(9428),g=t(9355),b=function(e){var n=e.room;return o.createElement("div",{className:"my-4 text-center"},(null==n?void 0:n.settings)&&Object.keys(null==n?void 0:n.settings).map((function(e){return o.createElement(c.ZT,{key:e,variant:"p"},e,": ",null==n?void 0:n.settings[e])})))};n.Z=(0,d.z)((function(e){var n=e.user,t=e.room,d=e.subscribeToRoomUpdates,f=e.subscribeToDeletion;(0,o.useEffect)((function(){null==n||!n.uid||null!=t&&t.players.map((function(e){return e.uid})).includes(n.uid)||(null==t?void 0:t.players.length)<(null==t?void 0:t.settings.maxPlayers)&&v({displayName:n.displayName,email:n.email,photoURL:n.photoURL,phoneNumber:n.phoneNumber,uid:n.uid}),null!==n&&Object.keys(n).length||console.log("allow play as guest")}),[n]),(0,o.useEffect)((function(){console.log("lobby subscribing to room updates"),d(),f()}),[]);var p=(0,l.D)(g.Db,{onError:function(e){s.Z.danger(m.$.extractGQLErrorMessage(e))}})[0],v=function(e){console.log("mutating room from lobby"),p({variables:{room:Object.assign({},t,{players:[].concat((0,r.Z)(null==t?void 0:t.players),[e])})}})},h=(0,l.D)(g.Y6,{onCompleted:function(e){(0,i.navigate)("/")},onError:function(e){s.Z.danger(m.$.extractGQLErrorMessage(e))}}),y=h[0],E=h[1].loading;return o.createElement(u.r,null,o.createElement(c.ZT,{variant:"h3",weight:"bold",className:"m-0"},"Wait here for others to join..."),o.createElement(c.ZT,{variant:"h5"},"The host will start the game soon."),o.createElement(c.J3,{players:null==t?void 0:t.players}),o.createElement(b,{room:t}),o.createElement(a.ZP,{to:"/"},o.createElement(c.zx,{className:"mb-4",outline:!0},"Back to home")),(null==n?void 0:n.uid)===(null==t?void 0:t.host)?o.createElement(c.zx,{className:"mb-4",color:"MediumSeaGreen",outline:!0,onClick:function(){return console.log("mutating room from lobby"),void p({variables:{room:Object.assign({},t,{started:!0})}})}},"Start Game"):null,(null==n?void 0:n.uid)===(null==t?void 0:t.host)?o.createElement(c.zx,{className:"mb-4",color:"Crimson",outline:!0,onClick:function(){y({variables:{host:n.uid}})},loading:E},"End game"):o.createElement(c.zx,{className:"mb-4",color:"Crimson",outline:!0,onClick:function(){return e={uid:null==n?void 0:n.uid},console.log("mutating room from lobby"),void p({variables:{room:Object.assign({},t,{players:(0,r.Z)(null==t?void 0:t.players.filter((function(n){return n.uid!==e.uid})))})}});var e},loading:E},"Leave game"))}))},1103:function(e,n,t){t.r(n),t.d(n,{default:function(){return R}});var r,o,a=t(3366),l=t(7294),i=t(5444),s=t(7955),u=t(4767),c=t(7487),m=t(7674),d=t(3919),g=t(8937),b=t(2739),f=(b.default.p.withConfig({displayName:"SmallText",componentId:"sc-1rfw216-0"})(["text-align:left;color:rgba(0,0,0,0.5);font-size:16px;padding:0;margin:0;"]),b.default.div.withConfig({displayName:"GameStageLeft",componentId:"sc-1ufujmc-0"})(["display:flex;flex-direction:column;height:100%;width:100%;padding:3rem;"," box-sizing:border-box;background-color:",";-webkit-background-size:cover;-moz-background-size:cover;-o-background-size:cover;background-size:cover;"],{width:"100%","@media (min-width: 768px)":{width:"66.666667%"}},(function(e){return e.theme.stageLeft}))),p=b.default.div.withConfig({displayName:"GameStageRight",componentId:"sc-16zg4u8-0"})(["display:flex;flex-direction:column;align-items:center;height:100%;width:100%;padding:3rem;"," box-sizing:border-box;background-color:",";border-top:3px solid ",";border-bottom:3px solid ",";-webkit-background-size:cover;-moz-background-size:cover;-o-background-size:cover;background-size:cover;overflow:hidden;"],{width:"100%","@media (min-width: 768px)":{width:"33.333333%"}},(function(e){return e.theme.GameStageRight}),(function(e){return e.theme.stageLeft}),(function(e){return e.theme.stageLeft})),v=b.default.div.withConfig({displayName:"MemeFrame",componentId:"sc-139a65m-0"})(["display:flex;background-color:",";padding:4px;margin:2rem 1rem;border-radius:4px;img{width:100%;border-radius:4px;@keyframes example{from{filter:blur(8px);}to{filter:blur(0px);}}filter:blur(18px);animation-name:example;animation-fill-mode:forwards;animation-duration:.6s;animation-delay:1s;}@media (min-width:768px){}"],(function(e){return e.theme.text})),h=t(259),y=t(9335),E=t(9482),w=t(9428),x=t(9355),T=(0,w.z)((function(e){var n=e.user,t=e.signInLoading,r=e.room,o=e.subscribeToRoomUpdates,a=e.subscribeToDeletion,s=(0,l.useState)(null),c=s[0],m=s[1];(0,l.useEffect)((function(){console.log("lobby subscribing to room updates"),o(),a()}),[]),(0,l.useEffect)((function(){null==n||!n.uid||null!=r&&r.players.map((function(e){return e.uid})).includes(n.uid)||(0,i.navigate)("/lost"),t||Object.keys(n).length||(0,i.navigate)("/lost"),null!=n&&n.uid&&n.uid===r.host&&(r.game?console.log("And we live->",r.game):w())}),[n]),(0,l.useEffect)((function(){if(r.game){var e=new E.lA(Object.assign({},r.game,{players:r.players}));console.log(e),m(e)}}),[r]);var b=(0,d.D)(x.Db,{onError:function(e){u.Z.danger(y.$.extractGQLErrorMessage(e))}})[0],w=function(e){var n,t;e&&r.game&&(t=r.game.currentTurn<r.players.length?r.game.currentTurn+1:null,console.log("Current turn updating to ",t),n=t?r.game.currentRound:r.game.currentRound+1,console.log("Current round updating to ",n));var o=new E.lA({rounds:r.settings.rounds,timeLimit:r.settings.timeLimit,currentRound:n,currentTurn:t,players:r.players,gameOver:null==c?void 0:c.lastRound});console.log("mutating room from game room"),b({variables:{room:Object.assign({},r,{triggerRound:!0,game:o.toGraphQLModel})}})};return l.createElement(g.Z,null,l.createElement("div",{className:"flex w-full h-full flex-col md:flex-row"},l.createElement(f,null,l.createElement("div",{className:"flex justify-between"},null!=c&&c.countDownTime?null:l.createElement(h.B7,{duration:null==c?void 0:c.timeLimit,currentTick:null==c?void 0:c.roundTime,controlled:!0,radius:30,active:Boolean(null==c?void 0:c.roundTime),onCompleted:function(){}}),l.createElement("div",{className:"flex flex-col"},l.createElement(h.ZT,{variant:"h6",weight:"bold",className:"m-0"},"Round "+(null==c?void 0:c.currentRound)),l.createElement(h.ZT,{variant:"tiny",weight:"bold",className:"m-0"},null==c?void 0:c.currentPlayer.displayName))),l.createElement("div",{className:"flex flex-col flex-1 items-center w-full"},l.createElement(v,null,l.createElement("img",{src:"https://assetblast.b-cdn.net/wp-content/uploads/2021/09/Facebook-will-smith-e1632766993863.jpeg?aspect_ratio=13:6&width=360&quality=60",alt:""})),null!=c&&c.gameOver?l.createElement(h.ez,null,l.createElement(h.ZT,{variant:"h3",weight:"bold",fon:!0,className:"m-0",fontFamily:"Press_Start_2P"},"Game Over!!")):l.createElement(l.Fragment,null,null!=c&&c.roundTimeElapsed?l.createElement(l.Fragment,null,l.createElement(h.ez,null,l.createElement(h.ZT,{variant:"h6",weight:"bold",fon:!0,className:"m-0",fontFamily:"Press_Start_2P",color:"red"},"Time is up!!")),(null==r?void 0:r.host)===n.uid?l.createElement(h.zx,{className:"my-4",color:"MediumSeaGreen",outline:!0,onClick:function(){return w(!0)}},"Start Next Round"):l.createElement(h.ZT,{className:"my-4",variant:"tiny",weight:"normal"},"Waiting for host to start the next round...")):(null==c?void 0:c.currentPlayer.uid)===n.uid?l.createElement(h.ZT,{className:"my-4",variant:"tiny",weight:"normal"}," Waiting for other players to submit a card..."):l.createElement(h.u5,{submitCaption:function(e){return function(e){var t=Object.assign([],c.cards||[]);t=t.filter((function(e){return e.user!==n.uid}));var o=new E.yb({user:n.uid,text:e});t.push(o);var a=new E.lA(Object.assign({},c,{cards:t}));b({variables:{room:Object.assign({},r,{game:a.toGraphQLModel})}})}(e)}}),l.createElement(h.Jy,{activePlayer:null==c?void 0:c.currentPlayer,isActivePlayer:(null==c?void 0:c.currentPlayer.uid)===n.uid,players:null==c?void 0:c.players,cards:null==c?void 0:c.cards,revealCard:function(e){return function(e){var n=Object.assign([],c.cards);n=n.map((function(n){return n.user===e?Object.assign({},n,{revealed:!0}):n}));var t=new E.lA(Object.assign({},c,{cards:n}));b({variables:{room:Object.assign({},r,{game:t.toGraphQLModel})}})}(e)},highlightCard:function(e){return function(e){var n=Object.assign([],c.cards);n=n.map((function(n){return n.user===e?Object.assign({},n,{highlighted:!0}):Object.assign({},n,{highlighted:!1})}));var t=new E.lA(Object.assign({},c,{cards:n}));b({variables:{room:Object.assign({},r,{game:t.toGraphQLModel})}})}(e)}})))),l.createElement(p,null,l.createElement(h.ZT,{variant:"h4",weight:"bold",className:"m-0"},"Leaderboard"),l.createElement(h.f9,{players:r.players}))),null!=c&&c.countDownTime?l.createElement(h.IT,{count:null==c?void 0:c.countDownTime}):null)})),N=t(2117),k=t(3597),Z=t(1880),O=t(5185),j=(0,O.ZP)(r||(r=(0,Z.Z)(["\n  subscription roomUpdated($slug: String!){\n    roomUpdated(slug: $slug){\n      id\n      host\n      slug\n      started\n      players{\n        displayName\n        email\n        photoURL\n        phoneNumber\n        uid\n        isHost\n      }\n      game {\n        rounds\n        timeLimit\n        currentRound\n        currentTurn\n        countDownTime\n        roundTime\n        roundTimeElapsed\n        gameOver\n        cards {\n          user\n          text\n          revealed\n          highlighted\n          selected\n        }\n      }\n      settings {\n        timeLimit\n        maxPlayers\n        rounds\n      }\n    }\n  }\n"]))),L=(0,O.ZP)(o||(o=(0,Z.Z)(["\n  subscription roomDeleted($slug: String!){\n    roomDeleted(slug: $slug){\n      id\n    }\n  }\n"]))),z=["user","signedIn","signInLoading","setUser"],C=function(e){var n=e.room,t=e.subscribeToRoomUpdates,r=e.subscribeToDeletion;return l.createElement(l.Fragment,null,l.createElement(c.Z,{title:"Game"}),n.started?l.createElement(T,{room:n,subscribeToRoomUpdates:t,subscribeToDeletion:r}):l.createElement(m.Z,{room:n,subscribeToRoomUpdates:t,subscribeToDeletion:r}))},R=(0,w.z)((function(e){e.user,e.signedIn,e.signInLoading,e.setUser;var n=(0,a.Z)(e,z);""===n["*"]&&(0,i.navigate)("/lost");var t=(0,s.a)(k.WS,{variables:{slug:n["*"]},onCompleted:function(e){0===e.rooms.length&&(0,i.navigate)("/lost")},onError:function(e){console.error(e)},fetchPolicy:"network-only"}),r=t.subscribeToMore,o=t.data,c=t.loading;return l.createElement(N.Ar,{title:"Game",content:!c&&Array.isArray(null==o?void 0:o.rooms)&&null!=o&&o.rooms.length?l.createElement(C,{room:o.rooms[0],subscribeToRoomUpdates:function(){return r({document:j,variables:{slug:n["*"]},updateQuery:function(e,n){var t=n.subscriptionData;return t.data?(e.rooms[0].host!==t.data.roomUpdated.host?u.Z.notify("Host reassigned!"):JSON.stringify(e.rooms[0].players)!==JSON.stringify(t.data.roomUpdated.players)&&(e.rooms[0].players.length<t.data.roomUpdated.players.length?u.Z.notify("Player joined!"):u.Z.warning("Player left!")),Object.assign({},e,{rooms:[t.data.roomUpdated]})):e}})},subscribeToDeletion:function(){r({document:L,variables:{slug:n["*"]},updateQuery:function(e){return(0,i.navigate)("/"),u.Z.danger("Game room closed!"),Object.assign({},e,{rooms:null})}})}}):null,isLoading:c})}))}}]);
//# sourceMappingURL=component---src-pages-play-js-b9f4b679a33a78f984dd.js.map